@model Kidoro.Models.viewModels.Transfo

@{
    ViewData["Title"] = "Add Transformation";
}

<section class="container mt-5">
    <h1 class="text-center">@ViewData["Title"]</h1>

    <form method="post" asp-controller="Transfo" asp-action="CreateTransfo" class="form">
        <div class="row">
            <div class="col-6">
                <div class="row">
                    <h2>Bloc</h2>

                    <div class="form-group">
                        <label for="Daty">Daty</label>
                        <input required type="date" class="form-control" id="Daty" name="Daty" />
                    </div>

                    <div class="form-group">
                        <label for="bloc">Bloc</label>
                        <select required name="bloc" class="form-select">
                            @foreach (var bloc in Model.ListBloc)
                            {
                                <option value="@bloc.id">
                                    @bloc.id
                                </option>
                            }
                        </select>
                    </div>
                </div>

                <div class="row">
                    <h2>Reste</h2>

                    <div class="form-group">
                        <label for="Longueur">Longueur</label>
                        <input required value="1.0" type="text" class="form-control decimal" id="Longueur"
                            name="longueur" />
                    </div>

                    <div class="form-group">
                        <label for="largeur">Largeur</label>
                        <input required value="1.0" type="text" class="form-control decimal" id="largeur"
                            name="largeur" />
                    </div>

                    <div class="form-group">
                        <label for="hauteur">Hauteur</label>
                        <input required value="1.0" type="text" class="form-control decimal" id="hauteur" name="h" />
                    </div>
                </div>
            </div>

            <div class="col-6">
                <h2>Usuels</h2>

                @foreach (var u in Model.ListUsuel)
                {
                    <div class="form-group">
                        <label for="@u.id">@u.val</label>
                        <input required value="0" type="number" class="form-control decimal" id="@u.id" name="@u.id" />
                    </div>
                }
            </div>
        </div>

        <button type="submit" class="btn btn-success btn-Transfo">
            Valider Transformation
        </button>
    </form>
</section>

<script>

    document.addEventListener( 'DOMContentLoaded', function () {
        const inputs = document.querySelectorAll( '.decimal' );

        inputs.forEach( input => {
            let timeoutId;

            input.addEventListener( 'input', function ( e ) {
                clearTimeout( timeoutId );

                // Délais de 2 secondes avant d'exécuter la fonction de validation
                timeoutId = setTimeout( () => {
                    validateInput( e.target );
                }, 2000 );
            } );
        } );

        function validateInput( inputElement ) {
            let value = inputElement.value;

            // Vérifie si la valeur est déjà valide
            if ( !isNaN( parseFloat( value ) ) && isFinite( value ) ) {
                inputElement.value = parseFloat( value ).toFixed( 2 );
            } else {
                inputElement.value = '';
            }
        }
    } );

</script>